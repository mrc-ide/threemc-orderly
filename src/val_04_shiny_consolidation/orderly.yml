script: script.R

artefacts:
  - data: 
      description: 
      - Results from OOS Validation
      filenames:
      - artefacts/results_oos.csv.gz
 
displayname: |
  - Pull through data for Circumcision Coverage Validation Shiny module.
  
# parameters:
#   is_paper:
#     default: TRUE 

packages:
  - threemc
  - sf
  - data.table
  - dplyr
  - stringr
  - TMB
  - naomi
  - orderly
  
sources:
  - source.R

depends:
  # shapefiles
  - 00a2_areas_join:
      id: latest
      use:
        depends/areas.geojson: artefacts/areas.geojson
  # aggregated surveys, including error bounds
  # - 00b4_survey_indicators:
  #     id: latest(parameter:is_paper == is_paper)     
  #     use: 
  #       depends/survey-circumcision-coverage.csv.gz: artefacts/survey-circumcision-coverage.csv.gz
  
  # results from OOS Validation
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "AGO")
  #     use: 
  #       depends/Results_AGO_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_AGO_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_AGO_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "BDI")
      use: 
        depends/Results_BDI_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_BDI_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_BDI_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "BEN")
      use: 
        depends/Results_BEN_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_BEN_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_BEN_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "BFA")
      use: 
        depends/Results_BFA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_BFA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_BFA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "BWA")
  #     use: 
  #       depends/Results_BWA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_BWA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_BWA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "CAF")
  #     use: 
  #       depends/Results_CAF_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_CAF_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_CAF_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "CIV")
      use: 
        depends/Results_CIV_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_CIV_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_CIV_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "CMR")
      use: 
        depends/Results_CMR_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_CMR_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_CMR_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "COD")
  #     use: 
  #       depends/Results_COD_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_COD_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_COD_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "COG")
      use: 
        depends/Results_COG_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_COG_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_COG_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "ETH")
      use: 
        depends/Results_ETH_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_ETH_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_ETH_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GAB")
  #     use: 
  #       depends/Results_GAB_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GAB_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GAB_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GHA")
  #     use: 
  #       depends/Results_GHA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GHA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GHA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GIN")
  #     use: 
  #       depends/Results_GIN_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GIN_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GIN_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GMB")
  #     use: 
  #       depends/Results_GMB_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GMB_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GMB_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GNB")
  #     use: 
  #       depends/Results_GNB_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GNB_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GNB_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "GNQ")
  #     use: 
  #       depends/Results_GNQ_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_GNQ_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_GNQ_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "KEN")
      use: 
        depends/Results_KEN_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_KEN_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_KEN_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "LBR")
      use: 
        depends/Results_LBR_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_LBR_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_LBR_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "LSO")
      use: 
        depends/Results_LSO_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_LSO_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_LSO_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "MLI")
      use: 
        depends/Results_MLI_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_MLI_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_MLI_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "MOZ")
  #     use: 
  #       depends/Results_MOZ_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_MOZ_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_MOZ_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "MWI")
      use: 
        depends/Results_MWI_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_MWI_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_MWI_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "NAM")
      use: 
        depends/Results_NAM_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_NAM_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_NAM_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "NER")
  #     use: 
  #       depends/Results_NER_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_NER_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_NER_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "NGA")
      use: 
        depends/Results_NGA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_NGA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_NGA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "RWA")
      use: 
        depends/Results_RWA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_RWA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_RWA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "SEN")
  #     use: 
  #       depends/Results_SEN_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_SEN_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_SEN_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "SLE")
      use: 
        depends/Results_SLE_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_SLE_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_SLE_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "SWZ")
      use: 
        depends/Results_SWZ_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_SWZ_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_SWZ_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "TCD")
      use: 
        depends/Results_TCD_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_TCD_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_TCD_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "TGO")
  #     use: 
  #       depends/Results_TGO_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_TGO_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_TGO_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "TZA")
  #     use: 
  #       depends/Results_TZA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_TZA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_TZA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "UGA")
  #     use: 
  #       depends/Results_UGA_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_UGA_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_UGA_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "ZAF")
      use: 
        depends/Results_ZAF_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_ZAF_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_ZAF_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  # - val_00a_oos_validation:
  #     id: latest(parameter:cntry == "ZMB")
  #     use: 
  #       depends/Results_ZMB_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
  #       depends/Results_ZMB_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
  #       depends/Results_ZMB_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
  - val_00a_oos_validation:
      id: latest(parameter:cntry == "ZWE")
      use: 
        depends/Results_ZWE_AgeGroup_Incidence_OOS.csv.gz: artefacts/Results_AgeGroup_Incidence_OOS.csv.gz
        depends/Results_ZWE_AgeGroup_Prevalence_OOS.csv.gz: artefacts/Results_AgeGroup_Prevalence_OOS.csv.gz
        depends/Results_ZWE_AgeGroup_Probability_OOS.csv.gz: artefacts/Results_AgeGroup_Probability_OOS.csv.gz
